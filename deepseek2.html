<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Multi-Search AI â€” Full Page Mode</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-primary: #0b0f14;
      --bg-secondary: #1b1f27;
      --bg-tertiary: #111;
      --accent-primary: #4cc9f0;
      --accent-secondary: #6cf;
      --text-primary: #eee;
      --text-secondary: #aaa;
      --success: #4caf50;
      --warning: #ff9800;
      --error: #f44336;
      --border-radius: 12px;
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    header {
      position: sticky;
      top: 0;
      background: var(--bg-tertiary);
      padding: 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .logo {
      margin: 0;
      color: var(--accent-primary);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .search-container {
      flex: 1;
      display: flex;
      gap: 8px;
      min-width: 280px;
    }
    
    input {
      flex: 1;
      padding: 12px 16px;
      border-radius: var(--border-radius);
      border: 2px solid #333;
      background: #222;
      color: var(--text-primary);
      font-size: 1rem;
      transition: var(--transition);
    }
    
    input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.3);
    }
    
    button {
      padding: 12px 18px;
      border-radius: var(--border-radius);
      border: 0;
      background: var(--accent-primary);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    button:hover {
      background: #3ab7dc;
      transform: translateY(-1px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .search-options {
      display: flex;
      gap: 8px;
      padding: 8px 0;
      width: 100%;
      flex-wrap: wrap;
    }
    
    .engine-option {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.9rem;
    }
    
    .history-btn {
      background: #333;
      color: #fff;
      padding: 10px 14px;
    }
    
    .results {
      padding: 20px;
      display: grid;
      gap: 16px;
      max-width: 1000px;
      margin: auto;
    }
    
    .result {
      padding: 20px;
      background: var(--bg-secondary);
      border: 1px solid #333;
      border-radius: var(--border-radius);
      transition: var(--transition);
      cursor: pointer;
    }
    
    .result:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      border-color: #444;
    }
    
    .result a {
      color: var(--accent-secondary);
      font-weight: 700;
      text-decoration: none;
      font-size: 1.1rem;
      display: block;
      margin-bottom: 8px;
    }
    
    .result a:hover {
      text-decoration: underline;
    }
    
    .meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 8px;
    }
    
    .snippet {
      color: #ccc;
      font-size: 0.95rem;
      margin-top: 8px;
      line-height: 1.5;
    }
    
    .viewer {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      flex-direction: column;
      z-index: 100;
    }
    
    .toolbar {
      background: var(--bg-tertiary);
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .toolbar button {
      background: #444;
      color: #fff;
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    .toolbar button:hover {
      background: #555;
    }
    
    iframe {
      flex: 1;
      width: 100%;
      border: 0;
      background: #fff;
    }
    
    .status {
      padding: 10px 16px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status.success {
      color: var(--success);
    }
    
    .status.error {
      color: var(--error);
    }
    
    .status.warning {
      color: var(--warning);
    }
    
    a.openNew {
      color: var(--accent-primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: var(--border-radius);
      transition: var(--transition);
    }
    
    a.openNew:hover {
      background: rgba(76, 201, 240, 0.1);
    }
    
    .loader {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(76, 201, 240, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent-primary);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .history-panel {
      position: fixed;
      top: 0;
      right: -350px;
      width: 350px;
      height: 100vh;
      background: var(--bg-tertiary);
      z-index: 20;
      padding: 20px;
      overflow-y: auto;
      transition: var(--transition);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
    }
    
    .history-panel.active {
      right: 0;
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }
    
    .history-item {
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      margin-bottom: 10px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .history-item:hover {
      background: #222;
    }
    
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 15;
    }
    
    .no-results {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }
    
    .searching {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      padding: 40px;
      flex-direction: column;
    }
    
    .searching .loader {
      width: 40px;
      height: 40px;
    }
    
    .key-hint {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    @media (max-width: 768px) {
      header {
        padding: 12px;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .history-panel {
        width: 300px;
        right: -300px;
      }
      
      .results {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 class="logo"><i class="fas fa-robot"></i> Multi-Search AI</h1>
    <div class="search-container">
      <input id="query" placeholder="Search something..."/>
      <button id="go"><i class="fas fa-search"></i> Search</button>
    </div>
    <div class="search-options">
      <label class="engine-option"><input type="checkbox" id="googleCheck" checked> Google</label>
      <label class="engine-option"><input type="checkbox" id="ddgCheck" checked> DuckDuckGo</label>
      <label class="engine-option"><input type="checkbox" id="wikiCheck" checked> Wikipedia</label>
      <button id="historyBtn" class="history-btn"><i class="fas fa-history"></i> History</button>
    </div>
  </header>

  <div id="results" class="results"></div>
  <div id="resultsStatus" class="status"><i class="fas fa-info-circle"></i> Ready. Type your query and press Enter to search.</div>

  <div id="viewerBox" class="viewer">
    <div class="toolbar">
      <button id="closeBtn"><i class="fas fa-arrow-left"></i> Back</button>
      <input id="viewerUrl"/>
      <a id="openNew" class="openNew" href="#" target="_blank"><i class="fas fa-external-link-alt"></i> Open in new tab</a>
      <button id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
    </div>
    <iframe id="viewer"></iframe>
    <div id="viewerStatus" class="status"><i class="fas fa-info-circle"></i> Ready to load page.</div>
  </div>
  
  <div class="overlay" id="overlay"></div>
  
  <div class="history-panel" id="historyPanel">
    <div class="history-header">
      <h3 style="margin:0"><i class="fas fa-history"></i> Search History</h3>
      <button id="closeHistory" class="history-btn"><i class="fas fa-times"></i></button>
    </div>
    <div id="historyList"></div>
  </div>

  <script>
    // DOM elements
    const q = document.getElementById('query'),
          go = document.getElementById('go'),
          results = document.getElementById('results'),
          resultsStatus = document.getElementById('resultsStatus'),
          viewerBox = document.getElementById('viewerBox'),
          viewer = document.getElementById('viewer'),
          viewerUrl = document.getElementById('viewerUrl'),
          viewerStatus = document.getElementById('viewerStatus'),
          openNew = document.getElementById('openNew'),
          closeBtn = document.getElementById('closeBtn'),
          refreshBtn = document.getElementById('refreshBtn'),
          historyBtn = document.getElementById('historyBtn'),
          historyPanel = document.getElementById('historyPanel'),
          closeHistory = document.getElementById('closeHistory'),
          overlay = document.getElementById('overlay'),
          googleCheck = document.getElementById('googleCheck'),
          ddgCheck = document.getElementById('ddgCheck'),
          wikiCheck = document.getElementById('wikiCheck');

    // State management
    let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
    let currentSearchEngines = {
      google: googleCheck.checked,
      duckduckgo: ddgCheck.checked,
      wikipedia: wikiCheck.checked
    };

    // Initialize
    function init() {
      updateHistoryUI();
      focusSearchInput();
      setupEventListeners();
    }

    // Focus search input on page load
    function focusSearchInput() {
      q.focus();
    }

    // Set up event listeners
    function setupEventListeners() {
      go.onclick = search;
      q.addEventListener('keydown', e => {
        if (e.key === 'Enter') search();
      });
      
      results.addEventListener('click', e => {
        const a = e.target.closest('a[data-url]');
        if (a) {
          e.preventDefault();
          openInside(a.dataset.url);
        }
      });
      
      viewerUrl.addEventListener('keydown', e => {
        if (e.key === 'Enter' && viewerUrl.value) openInside(viewerUrl.value);
      });
      
      closeBtn.onclick = closeViewer;
      refreshBtn.onclick = refreshViewer;
      
      historyBtn.onclick = openHistoryPanel;
      closeHistory.onclick = closeHistoryPanel;
      overlay.onclick = closeHistoryPanel;
      
      // Search engine checkboxes
      googleCheck.addEventListener('change', updateSearchEngines);
      ddgCheck.addEventListener('change', updateSearchEngines);
      wikiCheck.addEventListener('change', updateSearchEngines);
      
      // Keyboard shortcuts
      document.addEventListener('keydown', e => {
        // Escape key to close viewer or history
        if (e.key === 'Escape') {
          if (viewerBox.style.display === 'flex') {
            closeViewer();
          } else if (historyPanel.classList.contains('active')) {
            closeHistoryPanel();
          }
        }
        
        // Ctrl/Cmd + K to focus search
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          q.focus();
        }
      });
    }
    
    // Update search engines state
    function updateSearchEngines() {
      currentSearchEngines = {
        google: googleCheck.checked,
        duckduckgo: ddgCheck.checked,
        wikipedia: wikiCheck.checked
      };
    }

    // Sanitize HTML to remove scripts and event handlers
    function sanitize(html) {
      const doc = new DOMParser().parseFromString(html, 'text/html');
      
      // Remove scripts
      const scripts = doc.querySelectorAll('script');
      scripts.forEach(script => script.remove());
      
      // Remove event handlers from elements
      doc.querySelectorAll('*').forEach(element => {
        Array.from(element.attributes).forEach(attr => {
          if (attr.name.startsWith('on')) {
            element.removeAttribute(attr.name);
          }
        });
      });
      
      return doc.documentElement.outerHTML;
    }

    // Fetch with proxy
    async function fetchProxy(url) {
      try {
        viewerStatus.innerHTML = '<div class="loader"></div> Loading...';
        const r = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url));
        if (!r.ok) throw new Error("Proxy failed");
        return (await r.json()).contents;
      } catch (error) {
        console.error("Proxy error:", error);
        throw error;
      }
    }

    // Open URL inside the viewer
    async function openInside(url) {
      viewerBox.style.display = "flex";
      viewerUrl.value = url;
      openNew.href = url;
      viewerStatus.className = "status";
      viewerStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
      
      try {
        let html = await fetchProxy(url);
        const base = '<base href="' + url + '">';
        const style = "<style>body{max-width:900px;margin:auto;font-family:sans-serif;line-height:1.6}img,video{max-width:100%}</style>";
        
        if (/<head/i.test(html)) {
          html = html.replace(/<head[^>]*>/i, m => m + base + style);
        } else {
          html = base + style + html;
        }
        
        viewer.srcdoc = sanitize(html);
        viewerStatus.className = "status success";
        viewerStatus.innerHTML = '<i class="fas fa-check-circle"></i> Page loaded (scripts removed for security).';
      } catch (e) {
        viewer.srcdoc = "";
        viewerStatus.className = "status error";
        viewerStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> This site blocks embedding. Use \'Open in new tab\'.';
      }
    }

    // Close the viewer
    function closeViewer() {
      viewerBox.style.display = "none";
    }
    
    // Refresh the viewer
    function refreshViewer() {
      if (viewerUrl.value) {
        openInside(viewerUrl.value);
      }
    }

    // Perform search across selected engines
    async function search() {
      const query = q.value.trim();
      if (!query) {
        showNotification("Please enter a search query", "error");
        q.focus();
        return;
      }
      
      // Add to search history
      addToHistory(query);
      
      results.innerHTML = `
        <div class="searching">
          <div class="loader"></div>
          <div>Searching across ${getActiveEngineCount()} engines...</div>
        </div>
      `;
      resultsStatus.className = "status";
      resultsStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
      
      try {
        const promises = [];
        
        if (currentSearchEngines.wikipedia) {
          promises.push(
            fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`)
            .then(r => r.json())
            .then(data => ({
              engine: 'wikipedia',
              data: (data.query?.search || []).slice(0, 5).map(it => ({
                title: it.title,
                url: `https://en.wikipedia.org/wiki/${encodeURIComponent(it.title)}`,
                source: "Wikipedia",
                snippet: it.snippet
              }))
            }))
          );
        }
        
        if (currentSearchEngines.duckduckgo) {
          promises.push(
            fetchProxy("https://duckduckgo.com/html/?q=" + encodeURIComponent(query))
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const results = [...doc.querySelectorAll(".result")].slice(0, 5);
              
              return results.map(result => {
                const link = result.querySelector(".result__a");
                const snippet = result.querySelector(".result__snippet");
                
                return {
                  title: link?.textContent || "No title",
                  url: link?.href || "#",
                  source: "DuckDuckGo",
                  snippet: snippet?.textContent || ""
                };
              });
            })
            .then(data => ({ engine: 'duckduckgo', data }))
          );
        }
        
        if (currentSearchEngines.google) {
          promises.push(
            fetchProxy("https://www.google.com/search?q=" + encodeURIComponent(query))
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const results = [...doc.querySelectorAll("g-card")].slice(0, 5);
              
              return results.map(result => {
                const link = result.querySelector("a");
                const snippet = result.querySelector(".VwiC3b");
                
                return {
                  title: link?.textContent || "No title",
                  url: link?.href || "#",
                  source: "Google",
                  snippet: snippet?.textContent || ""
                };
              });
            })
            .then(data => ({ engine: 'google', data }))
          );
        }
        
        const resultsData = await Promise.allSettled(promises);
        displayResults(resultsData, query);
        
      } catch (e) {
        console.error("Search error:", e);
        results.innerHTML = `
          <div class="no-results">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h3>Search Failed</h3>
            <p>An error occurred while searching. Please try again.</p>
            <p><small>Error: ${e.message}</small></p>
          </div>
        `;
        resultsStatus.className = "status error";
        resultsStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Search failed. Please try again.';
      }
    }
    
    // Get count of active search engines
    function getActiveEngineCount() {
      return Object.values(currentSearchEngines).filter(Boolean).length;
    }
    
    // Display search results
    function displayResults(resultsData, query) {
      const allResults = [];
      
      resultsData.forEach(result => {
        if (result.status === 'fulfilled') {
          allResults.push(...result.value.data);
        }
      });
      
      if (allResults.length === 0) {
        results.innerHTML = `
          <div class="no-results">
            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h3>No Results Found</h3>
            <p>No results found for "${query}". Try different keywords or check your search engine selections.</p>
          </div>
        `;
        resultsStatus.className = "status warning";
        resultsStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> No results found.';
        return;
      }
      
      // Sort results by source for better organization
      const sortedResults = allResults.sort((a, b) => a.source.localeCompare(b.source));
      
      results.innerHTML = "";
      sortedResults.forEach(r => {
        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `
          <a href="${r.url}" data-url="${r.url}">${r.title}</a>
          ${r.snippet ? `<div class="snippet">${r.snippet}</div>` : ''}
          <div class="meta">
            <span>${r.source}</span>
            <span>${new URL(r.url).hostname}</span>
          </div>
        `;
        results.appendChild(div);
      });
      
      resultsStatus.className = "status success";
      resultsStatus.innerHTML = `<i class="fas fa-check-circle"></i> Found ${allResults.length} results. Click any result to view.`;
    }
    
    // Add query to search history
    function addToHistory(query) {
      // Avoid duplicates
      searchHistory = searchHistory.filter(item => item !== query);
      // Add to beginning of array
      searchHistory.unshift(query);
      // Keep only last 10 items
      if (searchHistory.length > 10) {
        searchHistory.pop();
      }
      
      // Save to localStorage
      localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
      
      // Update UI
      updateHistoryUI();
    }
    
    // Update history UI
    function updateHistoryUI() {
      const historyList = document.getElementById('historyList');
      
      if (searchHistory.length === 0) {
        historyList.innerHTML = '<div class="no-results">No search history yet</div>';
        return;
      }
      
      historyList.innerHTML = '';
      searchHistory.forEach(query => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `<i class="fas fa-search"></i> ${query}`;
        item.addEventListener('click', () => {
          q.value = query;
          search();
          closeHistoryPanel();
        });
        
        historyList.appendChild(item);
      });
    }
    
    // Open history panel
    function openHistoryPanel() {
      historyPanel.classList.add('active');
      overlay.style.display = 'block';
    }
    
    // Close history panel
    function closeHistoryPanel() {
      historyPanel.classList.remove('active');
      overlay.style.display = 'none';
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
      // In a real app, you might use a more sophisticated notification system
      alert(`${type.toUpperCase()}: ${message}`);
    }
    
    // Initialize the app
    init();
  </script>
</body>
</html>